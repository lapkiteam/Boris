# Концовки

## Описание концовок

### Исцеление

Самая лучшая концовка, в которой Бориса вылечивает медицина.

### Монстр

Он становится монстром. Поддается внутреннему зверю: пробует человеческую кровь.

### Псих

<!-- todo -->

## Таблица

| ИСЦЕЛЕНИЕ                            | МОНСТР                      | ПСИХ                                 |
|--------------------------------------|-----------------------------|--------------------------------------|
| Захлопнуть дверь перед носом девушки | Сдаться чарам девушки       | Взять пирожки и сразу же попробовать |
| Пристально посмотреть на девушку     | Схватить девушку сильнее    | Отпустить девушку                    |
| Постучать еще раз                    | Выломать дверь              | Выломать дверь                       |
| Отпустить курицу                     | Выпить кровь курицы         | Выбежать из подвала                  |
| Выбежать из подвала                  | Наброситься на старушку     | Наброситься на старушку              |
| Освободить зайчика и убежать         | Попробовать зайчика         | Убежать, бросив зайчика              |
| Ждать когда очнется шаман            | Укусить шамана              | Разбудить шамана                     |
| Прогнать кота                        | Укусить кота                | Схватить кота                        |
| Убежать в комнату                    | Наброситься на монахиню     | Наброситься на монахиню              |
| Сидеть и терпеть все                 | Попытаться укусить монахиню | Начать ругаться и обзываться         |

### Скрипт

```fsharp
#!dotnet fsi
#r "nuget: FSharpMyExt, 2.0.0-prerelease.9"
open FsharpMyExtension.Serialization.Serializers
open System.IO

let replace paragraphName var (input: string) =
    let r = Regex.create $"{paragraphName}.*?{{.*?}}"
    r.Replace(input, fun x -> $"{x.Value}\n{var}")

#r "nuget: Expecto, 10.2.1"
open Expecto

// [<Tests>]
// let replaceTest =
//     testList "replaceTest" [
//         testCase "1" <| fun () ->
//             Expect.equal (
//                 replace
//                     "Укусить шамана"
//                     @"<<set $monster to $monster + 1>>\"
//                     (
//                         String.concat "\n" [
//                             ":: Укусить шамана {sdf}"
//                             "текст1"
//                             ""
//                             ":: Укусить шамана {234}"
//                             "текст2"
//                         ]
//                     )
//             ) (
//                 String.concat "\n" [
//                     ":: Укусить шамана {sdf}"
//                     "<<set $monster to $monster + 1>>\\"
//                     "текст1"
//                     ""
//                     ":: Укусить шамана {234}"
//                     "<<set $monster to $monster + 1>>\\"
//                     "текст2"
//                 ]
//             ) ""
//     ]
//
// runTestsWithCLIArgs [] fsi.CommandLineArgs[1..] (
//     replaceTest
// )

let psycho =
    {|
        var = @"<<set $psycho to $psycho + 1>>\"
        paragraphs = [
            "Взять пирожки и сразу же попробовать"
            "Отпустить девушку"
            "Выломать дверь"
            "Выбежать из подвала"
            "Наброситься на старушку"
            "Убежать, бросив зайчика"
            "Разбудить шамана"
            "Схватить кота"
            "Наброситься на монахиню"
            "Начать ругаться и обзываться"
        ]
    |}

do
    let gamePath = "src/game.twee"
    let content = File.ReadAllText gamePath
    let content =
        psycho.paragraphs
        |> List.fold
            (fun state paragraphName ->
                replace paragraphName psycho.var state
            )
            content
    File.WriteAllText(gamePath, content)
```
